@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<style type="text/css">
		.upload{
			width: 550px;
			margin:auto;
            left:10px;
		}

</style>

<div>
    <input id="image_input" type="file" name="file[]" hidden accept="image/*" multiple/>
</div>
<div class="upload">
    <img id="upload"  src="~/upload.png" width=550 style="position:center">
</div>

<script>
    const image_input = document.getElementById("image_input");
    const upload = document.getElementById("upload");
    upload.onclick = function(){
        image_input.click()
    }

    function copyToClip(content, message) {
        var aux = document.createElement("input"); 
        aux.setAttribute("value", content); 
        document.body.appendChild(aux); 
        aux.select();
        document.execCommand("copy"); 
        document.body.removeChild(aux);
    }

    image_input.onchange = function(){
        var urls = ""
        var imgList = image_input.files

        if(imgList != undefined){
            var form = new FormData();
            for(var i = 0; i < imgList.length; i++){
                form.append("", imgList[i], imgList[i].name);
            }
            
            var settings = {
                "url": `${window.location.origin}/api/image`,
                "method": "POST",
                "timeout": 0,
                "processData": false,
                "mimeType": "multipart/form-data",
                "contentType": false,
                "data": form
            };
            
            $.ajax(settings).done(function (response) {
                var response = JSON.parse(response);
                if(response.statusCode == 200){
                    for(var i = 0; i < response.res.length; i++){
                        urls += `${window.location.origin}${response.res[i]}\n`
                    }
                    alert(urls)
                    copyToClip(urls, "")
                }
                else{
                    alert(`上传失败,{response.message}`);
                }
            });
        }
    }
</script>