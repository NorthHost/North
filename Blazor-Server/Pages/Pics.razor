@page "/Pics"

@using System.ComponentModel
@using AntDesign.TableModels
@using System.Text.Json;
@using ImageBed.Data.Access
@using ImageBed.Data.Entity
@using System.Net

@inject IJSRuntime JS
@inject MessageService _message
@inject NotificationService _notice
@inject NavigationManager NavigationManager

<Space>
    <SpaceItem>
        <Search Placeholder="Search what you want..." EnterButton="true" @bind-Value="searchText" Loading=@searchRunning OnSearch=@OnSearch/>
    </SpaceItem>
    <SpaceItem>
        <Upload Multiple
            @attributes=attrs
            FileList=fileList
            ShowUploadList=false
            OnChange="StartImport"
            OnCompleted="UploadFinished">
            <Button Type="@ButtonType.Primary" Ghost>导  入</Button>
        </Upload>
    </SpaceItem>
    @if ((imagesSelected != null ) && (imagesSelected.Count() > 0))
    {
        <SpaceItem><Button Type="@ButtonType.Primary" Ghost OnClick=@ExportSelectedImages>导  出</Button></SpaceItem>
        <SpaceItem><Button Danger Ghost OnClick=@RemoveSelectedImages>删 除</Button></SpaceItem>
    }
</Space>
<br/>
<br/>
<Table @ref="table"
       TItem="ImageEntity"
       DataSource="@imagesAll"
       @bind-PageSize="_pageSize"
       @bind-SelectedRows="@imagesSelected"
>
        <Selection Key="@(context.Id?.ToString())" />
        <Column @bind-Field="@context.Name" Align="@ColumnAlign.Center" Sortable>
            <a href=@context.Url>@context.Name</a>
        </Column>
        <Column @bind-Field="@context.Dpi" Align="@ColumnAlign.Center"/>
        <Column @bind-Field="@context.Size" Align="@ColumnAlign.Center" Sortable/>
        <Column @bind-Field="@context.UploadTime" Align="@ColumnAlign.Center" Sortable/>
        <Column @bind-Field="@context.RequestNum" Align="@ColumnAlign.Center" Sortable/>
        <Column @bind-Field="@context.Owner" Align="@ColumnAlign.Center" Sortable/>
        <ActionColumn Align="@ColumnAlign.Center">
            <Space>
                <SpaceItem><Button Type="@ButtonType.Primary" Ghost OnClick="()=>{CopyUrlToClip(NavigationManager.BaseUri + context.Url);}">复 制</Button></SpaceItem>
                <SpaceItem><Button Type="@ButtonType.Primary" Ghost OnClick="()=>{DownloadFile(NavigationManager.BaseUri + context.Url, context.Name);}">下 载</Button></SpaceItem>
                <SpaceItem><Button Type="@ButtonType.Primary" Danger Ghost OnClick="()=>{ RemoveImage(context); }">删 除</Button></SpaceItem>
            </Space>
        </ActionColumn>
</Table>