@page "/users"
@using North.Core.Entities
@using North.Data.Access
@using North.RCL.Texts

@inject OurDbContext _context

<MudStack Spacing="0" Class="mud-width-full mud-height-full overflow-hidden px-5">
    <MudTable Items="@UsersShow" Loading="@DataLoading" Filter="@UserFilter" Height="calc(100% - 116px)" Virtualize MultiSelection Hover FixedHeader FixedFooter Elevation="0" Class="mud-width-full" Style="min-height:calc(100% - 50px);">
        <ToolBarContent>
            <MudStack Row Spacing="5" Class="d-flex align-end mud-width-full ml-n4">
                <MudStack Class="mud-height-full" Style="width:300px;">
                    <MudTextField @bind-Value="@SearchText" Placeholder="搜索用户..." Style="height:40px;"
                                  Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Variant="Variant.Outlined"></MudTextField>
                </MudStack>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Outlined.Sync" Color="Color.Info" Style="height:40px;">视 图</MudButton> 
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Outlined.Add" Color="Color.Success" Style="height:40px;">新 增</MudButton>
            </MudStack>
        </ToolBarContent>
        <HeaderContent>
            <MudTh><IconText Icon="@Icons.Outlined.Person" Text="用户名" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.Email" Text="邮 箱" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.AdminPanelSettings" Text="权 限" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.Bolt" Text="状 态" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.Link" Text="API" Typo="Typo.subtitle1" IconStyle="transform:rotate(135deg)" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.FormatListBulleted" Text="上传数量 / 容量（单次）" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.Storage" Text="上传数量 / 容量（全部）" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
            <MudTh><IconText Icon="@Icons.Outlined.ModeEdit" Text="编 辑" Typo="Typo.subtitle1" Style="width:100%;"></IconText></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="用户名" Style="text-align:center;">
                <MudLink Typo="Typo.body2" Color="Color.Info" Href="@($"/user/{context.Id}")" Underline="Underline.None" Style="width:fit-content;">@context.Name</MudLink>
            </MudTd>
            <MudTd DataLabel="邮 箱" Style="text-align:center;">
                <MudLink Typo="Typo.body2" Color="Color.Info" Href="@($"/user/{context.Id}")" Underline="Underline.None" Style="width:fit-content;">@context.Email</MudLink>
            </MudTd>
            <MudTd DataLabel="权 限" Style="text-align:center;">
                <MudChip Color="@PermissionChipColor(context.Permission)">@PermissionChipText(context.Permission)</MudChip>
            </MudTd>
            <MudTd DataLabel="状 态" Style="text-align:center;">
                <MudChip Color="@StateChipColor(context.State)">@StateChipText(context.State)</MudChip>
            </MudTd>
            <MudTd DataLabel="API" Style="text-align:center;">
                @if (context.IsApiAvailable)
                {
                    <MudChip Color="Color.Success">可 用</MudChip>
                }
                else
                {
                    <MudChip Color="Color.Error">禁 用</MudChip>
                }
            </MudTd>
            <MudTd DataLabel="上传数量 / 容量（单次）" Style="text-align:center;">@($"{context.SingleMaxUploadNums} 张 / {context.SingleMaxUploadCapacity} MB")</MudTd>
            <MudTd DataLabel="上传数量 / 容量（全部）" Style="text-align:center;">@($"{context.MaxUploadNums} 张 / {context.MaxUploadCapacity} MB")</MudTd>
            <MudTd DataLabel="编 辑" Style="text-align:center;">
                <MudButtonGroup OverrideStyles="false">
                    <MudButton Color="Color.Info" Variant="Variant.Outlined">修 改</MudButton>
                    <MudButton Color="Color.Error" Variant="Variant.Outlined" OnClick="@(async () => await RemoveUser(context))">删 除</MudButton>
                </MudButtonGroup>
            </MudTd>
            </RowTemplate>
        <PagerContent>
            <MudTablePager RowsPerPageString="每页显示数量" PageSizeOptions="@(new int[] { 10, 15, 20, 25, 30 })" InfoFormat="{first_item} - {last_item} of {all_items}" />
        </PagerContent>
    </MudTable>
</MudStack>
